{% extends 'base.html' %}
{% set active_section = 'home' %}

{% block content %}
<div class="mdc-layout-grid">
  <div class="mdc-layout-grid__inner home-page">
    <div class="mdc-layout-grid__cell--span-12 hero">
      <h1 class="title">A distributed vulnerability database for Open Source</h1>
      <div class="explainer">
        <p>An open, distributed way of managing vulnerabilities for open source.</p>
      </div>
      <div class="cta">
        <a class="cta-primary link-button" href="{{ url_for('frontend_handlers.list_vulnerabilities') }}">Search Vulnerability Database</a>
        <a class="cta-primary link-button" href="#">Use the API</a>
        <a class="cta-secondary" href="#">Learn more</a>
      </div>
    </div>
    <div class="mdc-layout-grid__cell--span-12 ecosystem-counts">
      <h2 class="heading">Ecosystems</h2>
      <dl class="ecosystems">
        {% if ecosystem_counts %}
          {% set total = ecosystem_counts.values() | sum %}
          {% for ecosystem in ecosystem_counts %}
            {% if ecosystem_counts[ecosystem] > 30 %}
              <dd>
              <div class="ecosystems-line-mid"></div>
              <div class="ecosystems-line-0"></div>
              <div class="ecosystems-line-1"></div>
              <div class="ecosystems-line-2"></div>
              <div class="ecosystems-line-3"></div>
                {% set radius = [(ecosystem_counts[ecosystem] | log) / (total | log) * 100, 30] | max %}
                <p class="ecosystem">{{ ecosystem }}</p>
                <span class="ecosystem-count" style="
                   width: {{ radius }}px; height: {{ radius }}px; line-height: {{ radius }}px">
                  {{ ecosystem_counts[ecosystem] }}
                </span>
              </dd>
            {% endif %}
          {% endfor %}
        {% endif %}
      </dl>
    </div>

    <div class="mdc-layout-grid__cell--span-12 schema-info">
      <h2 class="heading">OSV schema</h2>
      <p class="description">
        All advisories in this database use the
        <a href="https://ossf.github.io/osv-schema/">OpenSSF OSV format</a>, which
        was developed in collaboration with open source communities. This
        infrastructure serves as an aggregator of
        <a href="https://github.com/ossf/osv-schema#open-source-vulnerability-schema">vulnerability databases</a>
        that have adopted this schema.
      </p>
      <p class="description">
        The OSV schema provides a human and machine readable data format to
        describe vulnerabilities in a way that precisely map to open source
        package versions.
      </p>
      <div class="mdc-layout-grid__inner">
        <div class="mdc-layout-grid__cell--span-12">
          <code-block>{
  "schema_version": "1.3.0",
  "id": "GHSA-c3g4-w6cv-6v7h",
  "modified": "2022-04-01T13:56:42Z",
  "published": "2022-04-01T13:56:42Z",
  "aliases": [ "CVE-2022-27651" ],
  "summary": "Non-empty default inheritable capabilities for linux container in Buildah",
  "details": "A bug was found in Buildah where containers were created ...",
  "affected": [
    {
      "package": {
        "ecosystem": "Go",
        "name": "github.com/containers/buildah"
      },
      "ranges": [
        {
          "type": "ECOSYSTEM",
          "events": [
            {
              "introduced": "0"
            },
            {
              "fixed": "1.25.0"
            }
          ]
        }
      ]
    }
  ],
  "references": [
    {
      "type": "WEB",
      "url": "https://github.com/containers/buildah/commit/..."
    },
    {
      "type": "PACKAGE",
      "url": "https://github.com/containers/buildah"
    }
  ],
}</code-block>
        </div>
      </div>
      <div class="cta">
        <a class="cta-secondary" href="https://security.googleblog.com/2021/06/announcing-unified-vulnerability-schema.html">Learn more</a>
      </div>
    </div>
    <div class="mdc-layout-grid__cell--span-12 usage-examples">
      <h2 class="heading">Use the API</h2>
      <p class="description">
        An easy-to-use API is available to query for all known vulnerabilities
        by either a commit hash, or a package version.
      </p>
      <div class="mdc-layout-grid__inner">
        <div class="code-card mdc-layout-grid__cell--span-6 mdc-layout-grid__cell--span-12-tablet">
          <h3 class="code-card-title">Query by commit hash</h3>
          <pre class="code-card-content" id="example-commit-hash">curl -X POST -d \
  '{"commit": "6879efc2c1596d11a6a6ad296f80063b558d5e0f"}' \
  "https://api.osv.dev/v1/query"</pre>
          <clipboard-copy class="code-card-copy" for="example-commit-hash">
            <mwc-icon-button class="icon" icon="content_copy"></mwc-icon-button>
          </clipboard-copy>
        </div>
        <div class="code-card mdc-layout-grid__cell--span-6 mdc-layout-grid__cell--span-12-tablet">
          <h3 class="code-card-title">Query by version number</h3>
          <pre class="code-card-content" id="example-version-number">curl -X POST -d \
  '{"version": "2.4.1",
    "package": {"name": "jinja2", "ecosystem": "PyPI"}}' \
  "https://api.osv.dev/v1/query"</pre>
          <clipboard-copy class="code-card-copy" for="example-version-number">
            <mwc-icon-button class="icon" icon="content_copy"></mwc-icon-button>
          </clipboard-copy>
        </div>
      </div>
    </div>
    <div class="mdc-layout-grid__cell--span-12 open-source-banner">
      <h2 class="heading">Open source</h2>
      <p class="description">
        This project is <a href="https://github.com/google/osv">open source</a>. Contributions are welcome!
      </p>
    </div>
  </div>
</div>
{% endblock %}
