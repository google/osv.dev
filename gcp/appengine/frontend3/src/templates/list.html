{% extends 'base.html' %}
{% set active_section = 'vulnerabilities' %}

{% macro table_header_cell(column_id, column_name) %}
<th
class="mdc-data-table__header-cell mdc-data-table__header-cell--with-sort"
role="columnheader"
scope="col"
aria-sort="none"
data-column-id="{{ column_id }}"
>
<div class="mdc-data-table__header-cell-wrapper">
  <div class="mdc-data-table__header-cell-label">
    {{ column_name }}
  </div>
  <mwc-icon-button class="mdc-data-table__sort-icon-button" icon="arrow_upward"
  aria-label="Sort by {{ column_name }}" aria-describedby="{{ column_id }}-status-label"></mwc-icon-button>
  <div class="mdc-data-table__sort-status-label" aria-hidden="true" id="{{ column_id }}-status-label">
  </div>
</div>
</th>
{% endmacro %}

{% block content %}
<div class="mdc-layout-grid list-page">
  <div class="mdc-layout-grid__inner">
    <div class="mdc-layout-grid__cell--span-8">
      <h1 class="title">Vulnerability Library</h1>
      <div class="search-container">
        <mwc-icon class="search-icon">search</mwc-icon>
        <mwc-textfield label="Package or ID search" icon="a" class="search-field"></mwc-textfield>
      </div>
    </div>
    <turbo-frame id="vulnerability-table" data-turbo-action="advance" target="_top">
      <div class="mdc-layout-grid__cell--span-12">
        Pages
        <a href="{{ url_for(request.endpoint) }}?page=1" data-turbo-frame="_self">1</a>
        <a href="{{ url_for(request.endpoint) }}?page=2" data-turbo-frame="_self">2</a>
        <a href="{{ url_for(request.endpoint) }}?page=3" data-turbo-frame="_self">3</a>
      </div>
      <div class="mdc-layout-grid__cell--span-12">
        <div class="vuln-table-container">
          <div class="vuln-table mdc-data-table">
            <table class="mdc-data-table__table" aria-label="Dessert calories">
              <thead>
                <tr class="mdc-data-table__header-row">
                  {{ table_header_cell('id', 'ID') }}
                  {{ table_header_cell('package', 'Packages') }}
                  {{ table_header_cell('summary', 'Summary') }}
                  {{ table_header_cell('affected-versions', 'Affected versions') }}
                  {{ table_header_cell('ecosystem', 'Ecosystem') }}
                  {{ table_header_cell('last-modified', 'Last modified') }}
                </tr>
              </thead>
              <tbody class="mdc-data-table__content">
                {% for vulnerability in vulnerabilities %}
                <tr class="mdc-data-table__row">
                  <td class="mdc-data-table__cell">
                    <a href="{{ url_for('frontend_handlers.vulnerability', id=vulnerability.id) }}">{{ vulnerability.id }}</a>
                  </td>
                  <td class="mdc-data-table__cell">
                    {% for package in vulnerability.packages %}
                    {{ package }}
                    {% endfor %}
                  </td>
                  <td class="mdc-data-table__cell">
                    {{ vulnerability.summary }}
                  </td>
                  <td class="mdc-data-table__cell">
                    {% for version in vulnerability.versions %}
                    {{ version }}
                    {% endfor %}
                  </td>
                  <td class="mdc-data-table__cell"></td>
                  <td class="mdc-data-table__cell"></td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </turbo-frame>
  </div>
</div>
{% endblock %}
